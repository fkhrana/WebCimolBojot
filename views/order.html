<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Order Cimol AA</title>
    <link rel="stylesheet" href="/common.css" />
    <link rel="stylesheet" href="/styleorder.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet"/>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
</head>
<body class="order-page">
    <header>
        <div class="logo">
            <a href="/"><img src="/Logo Cimolpng.png" alt="Logo Cimol Bojot AA"/></a>
        </div>
        <nav>
            <ul>
                <li><a href="/" class="nav-link">BERANDA</a></li>
                <li><a href="/#menu" class="nav-link">MENU</a></li>
                <li><a href="/#lokasi" class="nav-link">CABANG</a></li>
                <li><a href="/#kontak" class="nav-link">KONTAK</a></li>
            </ul>
        </nav>
        <a href="#" class="order-button">ORDER</a>
    </header>
    <main>
        <form hx-post="/form/order" method="POST">
            <!-- Pilih Cabang -->
            <div class="order-section">
                <h1>PILIH CABANG</h1>
                <div class="order-form">
                    <label for="cabang">Pilih Cabang Terdekat</label>
                    <select id="cabang" name="cabang" hx-get="/api/cabang" hx-trigger="load" required></select>
                </div>
            </div>
            <!-- Pilih Menu -->
            <div class="order-section">
                <h1>PILIH MENU</h1>
                <div class="menu-grid">
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolmoza.png" alt="Cimol Isi Mozarella"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL ISI MOZARELLA</h3>
                            <p>PORSI KECIL</p>
                            <p class="price">Rp11.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_mozarella_kecil" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolmoza.png" alt="Cimol Isi Mozarella"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL ISI MOZARELLA</h3>
                            <p>PORSI BESAR</p>
                            <p class="price">Rp22.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_mozarella_besar" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolmoza.png" alt="Cimol Bojot"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL BOJOT</h3>
                            <p>PORSI KECIL</p>
                            <p class="price">Rp6.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_bojot_kecil" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolmoza.png" alt="Cimol Bojot"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL BOJOT</h3>
                            <p>PORSI BESAR</p>
                            <p class="price">Rp12.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_bojot_besar" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolmoza.png" alt="Cimol Isi Ayam"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL ISI AYAM</h3>
                            <p>PORSI KECIL</p>
                            <p class="price">Rp11.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_ayam_kecil" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolmoza.png" alt="Cimol Isi Ayam"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL ISI AYAM</h3>
                            <p>PORSI BESAR</p>
                            <p class="price">Rp22.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_ayam_besar" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolbeef.png" alt="Cimol Isi Beef"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL ISI BEEF</h3>
                            <p>PORSI KECIL</p>
                            <p class="price">Rp11.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_beef_kecil" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-image">
                            <img src="/cimolbeef.png" alt="Cimol Isi Beef"/>
                        </div>
                        <div class="menu-info">
                            <h3>CIMOL ISI BEEF</h3>
                            <p>PORSI BESAR</p>
                            <p class="price">Rp22.000</p>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn minus">-</button>
                                <span class="quantity">0</span>
                                <button type="button" class="quantity-btn plus">+</button>
                                <input type="hidden" name="cimol_beef_besar" class="quantity-input" value="0"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Pilih Rasa -->
            <div class="order-section pilih-rasa" style="display: none;">
                <h1>PILIH RASA</h1>
                <div class="menu-options"></div>
            </div>
            <!-- Formulir Pemesanan -->
            <div class="order-section">
                <h1>FORMULIR PEMESANAN</h1>
                <div class="order-form">
                    <label for="nama">Nama Lengkap :</label>
                    <input type="text" id="nama" name="nama" required/>
                    <label for="telepon">Nomor Telepon :</label>
                    <input type="tel" id="telepon" name="telepon" required/>
                    <label for="catatan">Catatan Tambahan:</label>
                    <textarea id="catatan" name="catatan" rows="3" placeholder="Contoh: Tusukannya lebihin ya"></textarea>
                </div>
                <button type="submit" class="order-submit-button">Cek Detail Order</button>
            </div>
        </form>
    </main>
    <script>
        document.querySelectorAll(".quantity-selector").forEach((selector) => {
            const minusBtn = selector.querySelector(".minus");
            const plusBtn = selector.querySelector(".plus");
            const quantitySpan = selector.querySelector(".quantity");
            const quantityInput = selector.querySelector(".quantity-input");
            let quantity = 0;

            minusBtn.addEventListener("click", () => {
                if (quantity > 0) {
                    quantity--;
                    quantitySpan.textContent = quantity;
                    quantityInput.value = quantity;
                    updateMenuOptions();
                }
            });

            plusBtn.addEventListener("click", () => {
                quantity++;
                quantitySpan.textContent = quantity;
                quantityInput.value = quantity;
                updateMenuOptions();
            });
        });

        function updateMenuOptions() {
            const menuItems = [
                {id: "cimol_mozarella_kecil", name: "Cimol Mozarella Kecil"},
                {id: "cimol_mozarella_besar", name: "Cimol Mozarella Besar"},
                {id: "cimol_bojot_kecil", name: "Cimol Bojot Kecil"},
                {id: "cimol_bojot_besar", name: "Cimol Bojot Besar"},
                {id: "cimol_ayam_kecil", name: "Cimol Ayam Kecil"},
                {id: "cimol_ayam_besar", name: "Cimol Ayam Besar"},
                {id: "cimol_beef_kecil", name: "Cimol Beef Kecil"},
                {id: "cimol_beef_besar", name: "Cimol Beef Besar"},
            ];

            const container = document.querySelector(".menu-options");
            const pilihRasaSection = document.querySelector(".pilih-rasa");
            container.innerHTML = "";
            let totalQuantity = 0;

            menuItems.forEach((item) => {
                const input = document.querySelector(`input[name="${item.id}"]`);
                const quantity = parseInt(input.value);
                totalQuantity += quantity;
                if (quantity > 0) {
                    let groupHTML = `<div class="menu-group"><h3 class="group-title">${item.name}</h3>`;
                    for (let i = 1; i <= quantity; i++) {
                        groupHTML += `
                            <div class="menu-detail">
                                <h4>Porsi ${i}</h4>
                                <label for="bumbu_${item.id}_${i}">Bumbu :</label>
                                <select id="bumbu_${item.id}_${i}" name="bumbu_${item.id}_${i}" required>
                                    <option value="">-- Pilih --</option>
                                    <option value="ayam-bawang">Ayam Bawang</option>
                                    <option value="jagung-bakar">Jagung Bakar</option>
                                    <option value="pedas-asin">Pedas Asin</option>
                                    <option value="barbeque">Barbeque</option>
                                    <option value="balado">Balado</option>
                                </select>
                                <label for="topping_${item.id}_${i}">Topping :</label>
                                <select id="topping_${item.id}_${i}" name="topping_${item.id}_${i}" required>
                                    <option value="">-- Pilih --</option>
                                    <option value="daun-jeruk">Daun Jeruk</option>
                                    <option value="bawang-goreng">Bawang Goreng</option>
                                </select>
                                <label for="level_${item.id}_${i}">Level Kepedasan :</label>
                                <select id="level_${item.id}_${i}" name="level_${item.id}_${i}" required>
                                    <option value="">-- Pilih --</option>
                                    <option value="lv0">Level 0</option>
                                    <option value="lv1">Level 1</option>
                                    <option value="lv2">Level 2</option>
                                    <option value="lv3">Level 3</option>
                                    <option value="extra">Extra</option>
                                </select>
                            </div>
                        `;
                    }
                    groupHTML += `</div>`;
                    container.innerHTML += groupHTML;
                }
            });

            pilihRasaSection.style.display = totalQuantity > 0 ? "block" : "none";
        }

        document.querySelector("form").addEventListener("submit", (e) => {
            console.log("Form submitted");
            const formData = new FormData(e.target);
            for (let [key, value] of formData.entries()) {
                console.log(`${key}: ${value}`);
            }

            const teleponInput = document.querySelector("#telepon");
            const telepon = teleponInput.value.trim();
            console.log("Validating telepon:", { raw: telepon, hasLetters: /[a-zA-Z]/.test(telepon) });

            if (/[a-zA-Z]/.test(telepon)) {
                e.preventDefault();
                alert("Nomor telepon tidak boleh mengandung huruf!");
                teleponInput.focus();
                return;
            }

            const cleanTelepon = telepon.replace(/\D/g, '');
            if (!cleanTelepon.match(/^08[0-9]{8,10}$/)) {
                e.preventDefault();
                alert("Nomor telepon tidak valid! Harus mulai dengan 08 dan berisi 10-12 digit.");
                teleponInput.focus();
                return;
            }

            const quantities = document.querySelectorAll(".quantity-input");
            let hasQuantity = false;
            quantities.forEach((input) => {
                if (parseInt(input.value) > 0) hasQuantity = true;
            });
            if (!hasQuantity) {
                e.preventDefault();
                alert("Pilih minimal satu menu!");
            }
        });

        document.addEventListener("htmx:afterSwap", (event) => {
            if (event.detail.target.id === "cabang") {
                const select = event.detail.target;
                select.innerHTML = '<option value="">-- Pilih Cabang --</option>' + select.innerHTML;
            }
        });
    </script>
</body>
</html>